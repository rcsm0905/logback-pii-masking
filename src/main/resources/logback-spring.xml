<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <!-- Define the property once at the top -->
  <springProperty scope="context" name="logMaskFields" source="LOG_MASK_FIELDS"
    defaultValue="imageContent,ocrResult,ocrResultFormat,ocrResultDetail,CROPPED_FACE_FROM_DOC"/>

  <!--
    Optional Configuration Parameters (can be added to layout/maskingLayout below):
    
    JsonStructuredLayout:
      - maxNestingDepth: Maximum JSON nesting depth (default: 50)
      - maxStringLength: Maximum string length in bytes (default: 10000000 = 10MB)
      - maxDocumentLength: Maximum document size in bytes (default: 10000000 = 10MB)
    
    PiiDataMasker:
      - maxJsonDepth: Maximum depth to traverse (default: 50)
      - maxNodes: Maximum number of nodes to process (default: 10000)
  -->

  <!-- Set prettyPrint property based on profile -->
  <springProfile name="local">
    <property name="prettyPrint" value="true"/>
  </springProfile>
  <springProfile name="!local">
    <property name="prettyPrint" value="false"/>
  </springProfile>

  <!-- Console appender with JSON layout and PII masking -->
  <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
    <encoder class="ch.qos.logback.core.encoder.LayoutWrappingEncoder">
      <layout class="com.example.logging.JsonStructuredLayout">
        <prettyPrint>${prettyPrint}</prettyPrint>
        <maskingLayout class="com.example.logging.PiiDataMasker">
          <maskedFields>${logMaskFields}</maskedFields>
          <maskToken>[REDACTED]</maskToken>
        </maskingLayout>
      </layout>
    </encoder>
  </appender>

  <root level="INFO">
    <appender-ref ref="CONSOLE"/>
  </root>
</configuration>